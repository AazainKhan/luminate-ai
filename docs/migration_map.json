{
  "metadata": {
    "created": "2025-10-08",
    "purpose": "Map LangGraph agents/nodes to LangFlow components",
    "langgraph_version": "0.6.8",
    "langflow_version": "1.6.4",
    "total_agents": 11
  },
  "agent_mappings": {
    "query_understanding_agent": {
      "langflow_component": "Prompt + LLM Chain",
      "type": "sequential",
      "components": [
        {
          "name": "Query Analysis Prompt",
          "type": "Prompt Template",
          "config": {
            "template": "Analyze student query: {query}. Extract: category, student_goal, expanded_query"
          }
        },
        {
          "name": "Understanding LLM",
          "type": "Google Generative AI",
          "config": {
            "model": "gemini-2.0-flash-exp",
            "temperature": 0.3
          }
        }
      ],
      "inputs": ["query"],
      "outputs": ["parsed_query"],
      "notes": "Use LangFlow's built-in Prompt + LLM components"
    },
    "retrieval_agent": {
      "langflow_component": "Vector Store Retriever",
      "type": "builtin",
      "components": [
        {
          "name": "ChromaDB Retriever",
          "type": "Chroma Vector Store",
          "config": {
            "collection_name": "course_materials",
            "k": 10,
            "score_threshold": 0.7
          }
        }
      ],
      "inputs": ["query", "parsed_query"],
      "outputs": ["retrieved_chunks", "retrieval_metadata"],
      "notes": "LangFlow has native ChromaDB integration"
    },
    "context_agent": {
      "langflow_component": "Custom Python Function",
      "type": "custom",
      "components": [
        {
          "name": "Context Enrichment",
          "type": "Python Function Component",
          "config": {
            "function": "Add prerequisites, related topics from knowledge graph"
          }
        }
      ],
      "inputs": ["retrieved_chunks", "parsed_query"],
      "outputs": ["enriched_results"],
      "notes": "Create custom component with graph logic from agents/context.py"
    },
    "formatting_agent": {
      "langflow_component": "Prompt + LLM Chain",
      "type": "sequential",
      "components": [
        {
          "name": "Navigate Formatting Prompt",
          "type": "Prompt Template",
          "config": {
            "template": "Format search results for UI: {enriched_results}"
          }
        },
        {
          "name": "Formatting LLM",
          "type": "Google Generative AI",
          "config": {
            "model": "gemini-2.0-flash-exp",
            "temperature": 0.2
          }
        }
      ],
      "inputs": ["enriched_results", "query"],
      "outputs": ["formatted_response"],
      "notes": "Use Gemini 2.0 for fast formatting"
    },
    "student_model_agent": {
      "langflow_component": "Custom Supabase Component",
      "type": "custom",
      "components": [
        {
          "name": "Student Model Tracker",
          "type": "Custom Python Component",
          "config": {
            "supabase_url": "$SUPABASE_URL",
            "supabase_key": "$SUPABASE_KEY",
            "functions": ["get_mastery", "update_mastery", "detect_misconceptions"]
          }
        }
      ],
      "inputs": ["query", "student_id", "conversation_history"],
      "outputs": ["student_insights", "student_context"],
      "notes": "Requires custom LangFlow component with Supabase SDK"
    },
    "math_translation_agent": {
      "langflow_component": "Conditional Branch + Custom Function",
      "type": "conditional",
      "components": [
        {
          "name": "Formula Detector",
          "type": "Python Function",
          "config": {
            "function": "Regex match for math formulas (e.g., 'P(A|B)', 'sigmoid')"
          }
        },
        {
          "name": "Formula Explainer",
          "type": "Custom Python Component",
          "config": {
            "formula_database": "agents/math_translation_agent.py"
          }
        }
      ],
      "inputs": ["query"],
      "outputs": ["math_markdown", "formatted_response"],
      "notes": "If formula detected, short-circuit to END; else continue"
    },
    "pedagogical_planner_agent": {
      "langflow_component": "Prompt + LLM Chain",
      "type": "sequential",
      "components": [
        {
          "name": "Strategy Selection Prompt",
          "type": "Prompt Template",
          "config": {
            "template": "Choose teaching strategy for query: {query}. Student mastery: {student_insights}"
          }
        },
        {
          "name": "Planner LLM",
          "type": "Google Generative AI",
          "config": {
            "model": "gemini-2.5-flash-exp",
            "temperature": 0.5
          }
        }
      ],
      "inputs": ["parsed_query", "student_insights", "retrieved_chunks"],
      "outputs": ["teaching_strategy", "interaction_prompts"],
      "notes": "Use Gemini 2.5 for advanced reasoning"
    },
    "interactive_formatting_agent": {
      "langflow_component": "Prompt + LLM Chain",
      "type": "sequential",
      "components": [
        {
          "name": "Interactive Response Prompt",
          "type": "Prompt Template",
          "config": {
            "template": "Generate {teaching_strategy} response: hints, worked_examples, or socratic_questions"
          }
        },
        {
          "name": "Interactive LLM",
          "type": "Google Generative AI",
          "config": {
            "model": "gemini-2.5-flash-exp",
            "temperature": 0.7
          }
        }
      ],
      "inputs": ["teaching_strategy", "query", "retrieved_chunks"],
      "outputs": ["formatted_response"],
      "notes": "Final output node for Educate mode"
    },
    "quiz_generator_agent": {
      "langflow_component": "Prompt + LLM Chain",
      "type": "sequential",
      "components": [
        {
          "name": "Quiz Generation Prompt",
          "type": "Prompt Template",
          "config": {
            "template": "Create adaptive quiz for {query}. Difficulty: {student_insights.mastery_level}"
          }
        },
        {
          "name": "Quiz LLM",
          "type": "Google Generative AI",
          "config": {
            "model": "gemini-2.5-flash-exp",
            "temperature": 0.6
          }
        }
      ],
      "inputs": ["query", "student_insights", "retrieved_chunks"],
      "outputs": ["quiz_data"],
      "notes": "Triggered by conditional routing in Educate mode"
    },
    "study_planner_agent": {
      "langflow_component": "Prompt + LLM Chain + Calendar Logic",
      "type": "sequential",
      "components": [
        {
          "name": "Study Plan Prompt",
          "type": "Prompt Template",
          "config": {
            "template": "Create study plan for {query}. Week: {student_context.week_number}"
          }
        },
        {
          "name": "Planner LLM",
          "type": "Google Generative AI",
          "config": {
            "model": "gemini-2.5-flash-exp",
            "temperature": 0.4
          }
        },
        {
          "name": "Calendar Formatter",
          "type": "Python Function",
          "config": {
            "function": "Convert plan to calendar events"
          }
        }
      ],
      "inputs": ["query", "student_context", "retrieved_chunks"],
      "outputs": ["study_plan"],
      "notes": "Triggered by conditional routing (study keywords)"
    },
    "external_resources_agent": {
      "langflow_component": "API Call + Custom Component",
      "type": "custom",
      "components": [
        {
          "name": "YouTube Search",
          "type": "API Component",
          "config": {
            "api": "YouTube Data API v3",
            "endpoint": "/search",
            "max_results": 3
          }
        },
        {
          "name": "OER Search",
          "type": "Custom Python Component",
          "config": {
            "api": "OER Commons API",
            "filters": ["COMP237", "machine learning"]
          }
        }
      ],
      "inputs": ["query", "understood_query"],
      "outputs": ["external_resources"],
      "notes": "May require custom LangFlow components for APIs"
    }
  },
  "state_mappings": {
    "NavigateState": {
      "langflow_equivalent": "Flow Variables + Memory",
      "fields": {
        "query": "Input Variable",
        "chroma_db": "Vector Store Connection",
        "parsed_query": "LLM Output Variable",
        "retrieved_chunks": "Retriever Output Variable",
        "enriched_results": "Python Function Output",
        "external_resources": "API Output Variable",
        "formatted_response": "Final Output Variable",
        "retrieval_metadata": "Metadata Variable",
        "trace_callback": "LangFlow built-in tracing (not needed)"
      }
    },
    "EducateState": {
      "langflow_equivalent": "Flow Variables + Memory Nodes",
      "fields": {
        "query": "Input Variable",
        "math_markdown": "Python Function Output",
        "teaching_strategy": "LLM Output Variable",
        "student_insights": "Supabase Component Output",
        "quiz_data": "LLM Output Variable",
        "study_plan": "LLM + Function Output",
        "formatted_response": "Final Output Variable"
      }
    },
    "OrchestratorState": {
      "langflow_equivalent": "Parent Flow with Conditional Branches",
      "fields": {
        "mode": "Conditional Router Output",
        "next_graph": "Branch Selector (navigate_graph or educate_graph)",
        "conversation_history": "Memory Component (Session State)",
        "student_context": "Supabase Component Output"
      }
    }
  },
  "workflow_mappings": {
    "navigate_graph": {
      "langflow_flow_name": "Navigate Mode Flow",
      "nodes": [
        "Input: query",
        "query_understanding_agent → parsed_query",
        "retrieval_agent → retrieved_chunks",
        "external_resources_agent → external_resources",
        "context_agent → enriched_results",
        "formatting_agent → formatted_response",
        "Output: formatted_response"
      ],
      "connections": "Linear flow (no conditionals)"
    },
    "educate_graph": {
      "langflow_flow_name": "Educate Mode Flow",
      "nodes": [
        "Input: query, student_id",
        "query_understanding_agent → parsed_query",
        "student_model_agent → student_insights",
        "math_translation_agent → [conditional: if formula found, END]",
        "pedagogical_planner_agent → teaching_strategy",
        "generate_visualization → [placeholder, pass-through]",
        "retrieval_agent → retrieved_chunks",
        "Conditional Router:",
        "  - IF 'quiz' in query → quiz_generator_agent",
        "  - IF 'study plan' in query → study_planner_agent",
        "  - ELSE → context_agent",
        "context_agent → enriched_results",
        "interactive_formatting_agent → formatted_response",
        "Output: formatted_response"
      ],
      "connections": "Linear with 1 conditional router after retrieval"
    },
    "orchestrator": {
      "langflow_flow_name": "Parent Orchestrator Flow",
      "nodes": [
        "Input: query, student_id, session_id",
        "Mode Classifier (Prompt + LLM):",
        "  - Analyze query for Navigate/Educate intent",
        "  - Output: mode, confidence",
        "Conditional Router:",
        "  - IF mode == 'navigate' → Invoke navigate_graph",
        "  - IF mode == 'educate' → Invoke educate_graph",
        "Output: formatted_response from selected graph"
      ],
      "connections": "Conditional branches to sub-flows"
    }
  },
  "custom_components_required": [
    {
      "name": "Supabase Student Model",
      "purpose": "Track student mastery and misconceptions",
      "dependencies": ["supabase-py"],
      "functions": ["get_student_context", "update_mastery", "log_interaction"]
    },
    {
      "name": "Math Formula Translator",
      "purpose": "Detect and explain formulas (P(A|B), sigmoid, etc.)",
      "dependencies": ["regex", "formula database from agents/math_translation_agent.py"],
      "functions": ["detect_formula", "explain_formula"]
    },
    {
      "name": "Context Enrichment",
      "purpose": "Add course prerequisites and related topics",
      "dependencies": ["knowledge graph from agents/context.py"],
      "functions": ["add_prerequisites", "add_related_topics"]
    },
    {
      "name": "External Resources Fetcher",
      "purpose": "Search YouTube, OER Commons for supplementary materials",
      "dependencies": ["YouTube Data API", "OER Commons API"],
      "functions": ["search_youtube", "search_oer"]
    }
  ],
  "migration_notes": [
    "LangFlow 1.6.4 supports ChromaDB natively—use built-in Vector Store Retriever",
    "Gemini models accessible via Google Generative AI component",
    "Conditional routing: Use LangFlow's IF/ELSE nodes after retrieval",
    "State persistence: Use Memory components for conversation_history",
    "Tracing: LangFlow has native execution logs; no need for trace_callback",
    "Custom components: Documented at langflow.dev/docs/custom-components"
  ],
  "potential_issues": [
    {
      "issue": "Supabase integration",
      "solution": "Create custom LangFlow component with supabase-py SDK"
    },
    {
      "issue": "Math translation short-circuit",
      "solution": "Use conditional branch: if formula detected, skip to Output node"
    },
    {
      "issue": "TypedDict → YAML conversion",
      "solution": "Map fields to LangFlow variables; use Memory for complex objects"
    },
    {
      "issue": "External API rate limits",
      "solution": "Add caching in custom components; use LangFlow's retry logic"
    },
    {
      "issue": "Streaming responses",
      "solution": "LangFlow supports streaming; enable in LLM component settings"
    }
  ]
}
