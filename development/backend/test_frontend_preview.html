<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Translation Agent - Frontend Preview</title>
    
    <!-- KaTeX CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- KaTeX JS -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <style>
        body {
            background: #0f172a;
            color: #e2e8f0;
            font-family: system-ui, -apple-system, sans-serif;
        }
        .chat-message {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        pre code {
            border-radius: 8px;
        }
        .formula-level {
            border-left: 4px solid;
            padding-left: 1rem;
            margin: 1.5rem 0;
        }
        .level-1 { border-color: #8b5cf6; }
        .level-2 { border-color: #3b82f6; }
        .level-3 { border-color: #10b981; }
        .level-4 { border-color: #ef4444; }
    </style>
</head>
<body class="p-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center">
                    <span class="text-white text-xl font-bold">L</span>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-white">Luminate AI - Educate Mode</h1>
                    <p class="text-sm text-gray-400">Math Translation Agent Preview</p>
                </div>
            </div>
        </div>

        <!-- Test Controls -->
        <div class="mb-8 p-4 bg-gray-800 rounded-lg">
            <label class="block text-sm font-medium mb-2">Test Math Formula:</label>
            <div class="flex gap-2">
                <select id="formulaSelect" class="flex-1 bg-gray-700 text-white px-4 py-2 rounded-lg border border-gray-600">
                    <option value="explain gradient descent">Gradient Descent</option>
                    <option value="what is backpropagation">Backpropagation</option>
                    <option value="cross-entropy loss">Cross-Entropy Loss</option>
                    <option value="sigmoid function">Sigmoid Activation</option>
                    <option value="bayes theorem">Bayes' Theorem</option>
                </select>
                <button onclick="loadFormula()" class="px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition">
                    Load Formula
                </button>
            </div>
            <div id="status" class="mt-2 text-sm text-gray-400"></div>
        </div>

        <!-- Chat Messages -->
        <div id="chatContainer" class="space-y-4">
            <!-- Welcome message -->
            <div class="chat-message p-4 bg-purple-900/20 rounded-lg border border-purple-500/30">
                <div class="flex items-center gap-2 mb-2">
                    <div class="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center">
                        <span class="text-white text-sm">üéì</span>
                    </div>
                    <span class="font-medium text-purple-300">Educate Mode</span>
                </div>
                <div class="text-gray-300">
                    <p>üëã Welcome! I can explain math formulas in 4 levels:</p>
                    <ol class="mt-2 ml-4 space-y-1 text-sm">
                        <li>üéØ <strong>Intuition</strong> - 5-year-old explanation</li>
                        <li>üìä <strong>Math</strong> - Formula with plain English</li>
                        <li>üíª <strong>Code</strong> - Working Python implementation</li>
                        <li>‚ùå <strong>Misconceptions</strong> - Common mistakes</li>
                    </ol>
                    <p class="mt-3 text-sm text-gray-400">Select a formula above to see how it works!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Marked.js for markdown rendering (inline)
        const marked = {
            parse: (md) => {
                // Basic markdown parsing
                let html = md
                    // Headers
                    .replace(/^#### (.*$)/gim, '<h4 class="text-lg font-semibold mt-4 mb-2 text-purple-300">$1</h4>')
                    .replace(/^### (.*$)/gim, '<h3 class="text-xl font-semibold mt-6 mb-3 text-blue-300">$1</h3>')
                    .replace(/^## (.*$)/gim, '<h2 class="text-2xl font-bold mt-8 mb-4 text-white">$1</h2>')
                    .replace(/^# (.*$)/gim, '<h1 class="text-3xl font-bold mb-6 text-white">$1</h1>')
                    // Code blocks
                    .replace(/```python\n([\s\S]*?)```/g, '<pre><code class="language-python">$1</code></pre>')
                    .replace(/```(.*?)\n([\s\S]*?)```/g, '<pre><code class="language-$1">$2</code></pre>')
                    // Inline code
                    .replace(/`([^`]+)`/g, '<code class="px-1.5 py-0.5 bg-gray-700 rounded text-sm text-purple-300">$1</code>')
                    // Bold
                    .replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold text-white">$1</strong>')
                    // Lists
                    .replace(/^\- (.*$)/gim, '<li class="ml-4">$1</li>')
                    // Paragraphs
                    .replace(/\n\n/g, '</p><p class="mb-3">')
                    // Line breaks
                    .replace(/\n/g, '<br>');
                
                return '<p class="mb-3">' + html + '</p>';
            }
        };

        async function loadFormula() {
            const select = document.getElementById('formulaSelect');
            const query = select.value;
            const status = document.getElementById('status');
            const container = document.getElementById('chatContainer');
            
            status.textContent = '‚è≥ Loading...';
            
            try {
                // Show user message
                const userMsg = document.createElement('div');
                userMsg.className = 'chat-message p-4 bg-gray-800 rounded-lg ml-8';
                userMsg.innerHTML = `
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center">
                            <span class="text-white text-sm">üë§</span>
                        </div>
                        <span class="font-medium text-blue-300">You</span>
                    </div>
                    <p class="text-gray-300">${query}</p>
                `;
                container.appendChild(userMsg);
                
                // Fetch from API
                const response = await fetch('http://localhost:8000/api/query', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });
                
                const data = await response.json();
                status.textContent = `‚úÖ Loaded (${data.mode} mode, ${(data.confidence*100).toFixed0}% confidence)`;
                
                // Show assistant message
                const assistantMsg = document.createElement('div');
                assistantMsg.className = 'chat-message p-4 bg-purple-900/20 rounded-lg border border-purple-500/30';
                
                const content = data.response.formatted_response;
                assistantMsg.innerHTML = `
                    <div class="flex items-center gap-2 mb-4">
                        <div class="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center">
                            <span class="text-white text-sm">üéì</span>
                        </div>
                        <span class="font-medium text-purple-300">Educate Mode</span>
                        <span class="text-xs text-gray-400 ml-auto">4-Level Translation</span>
                    </div>
                    <div class="prose prose-invert max-w-none">
                        ${marked.parse(content)}
                    </div>
                `;
                container.appendChild(assistantMsg);
                
                // Render LaTeX
                renderMathInElement(assistantMsg, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false}
                    ]
                });
                
                // Syntax highlight code
                assistantMsg.querySelectorAll('pre code').forEach(block => {
                    hljs.highlightElement(block);
                });
                
                // Scroll to bottom
                assistantMsg.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                
            } catch (error) {
                status.textContent = `‚ùå Error: ${error.message}`;
                console.error('Error:', error);
            }
        }
        
        // Load first formula on page load
        window.addEventListener('load', () => {
            setTimeout(loadFormula, 500);
        });
    </script>
</body>
</html>
